<?php require_once '../config/config.php'; require_once '../session.php'; $uid=require_user(); if($_SERVER['REQUEST_METHOD']==='POST'){ $d=json_decode(file_get_contents('php://input'),true); $amount=floatval($d['amount']??0); if($amount<=0){http_response_code(400);echo json_encode(['error'=>'Invalid amount']);exit;} $st=$pdo->prepare('SELECT balance FROM users WHERE id=?');$st->execute([$uid]); $bal=floatval($st->fetch()['balance']); if($amount>$bal){http_response_code(400);echo json_encode(['error'=>'Insufficient balance']);exit;} $pdo->prepare('INSERT INTO withdrawals(user_id,amount) VALUES(?,?)')->execute([$uid,$amount]); echo json_encode(['success'=>true]); } else { $st=$pdo->prepare('SELECT * FROM withdrawals WHERE user_id=? ORDER BY created_at DESC');$st->execute([$uid]); echo json_encode(['success'=>true,'withdrawals'=>$st->fetchAll()]); } ?>