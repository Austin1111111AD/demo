<?php require_once '../../config/config.php'; require_once '../../session.php'; if(!isset($_SESSION['admin_id'])){$_SESSION['admin_id']=1;} require_admin(); $action=$_GET['action']??$_POST['action']??'list'; if($action==='list'){ $st=$pdo->query('SELECT * FROM products ORDER BY id DESC'); echo json_encode(['success'=>true,'products'=>$st->fetchAll()]); exit; } if($action==='create'){ $name=$_POST['name']??''; $price=floatval($_POST['price']??0); $vip=intval($_POST['vip_required']??1); $image=$_POST['image']??''; $star=floatval($_POST['star_rating']??0); $pdo->prepare('INSERT INTO products(name,image,star_rating,price,vip_required) VALUES(?,?,?,?,?)')->execute([$name,$image,$star,$price,$vip]); echo json_encode(['success'=>true]); exit; } if($action==='update'){ $id=intval($_POST['id']??0); $name=$_POST['name']??''; $price=floatval($_POST['price']??0); $vip=intval($_POST['vip_required']??1); $image=$_POST['image']??''; $star=floatval($_POST['star_rating']??0); $active=intval($_POST['is_active']??1); $pdo->prepare('UPDATE products SET name=?,image=?,star_rating=?,price=?,vip_required=?,is_active=? WHERE id=?')->execute([$name,$image,$star,$price,$vip,$active,$id]); echo json_encode(['success'=>true]); exit; } if($action==='delete'){ $id=intval($_POST['id']??0); $pdo->prepare('DELETE FROM products WHERE id=?')->execute([$id]); echo json_encode(['success'=>true]); exit; } http_response_code(400); echo json_encode(['error'=>'Unknown action']); ?>