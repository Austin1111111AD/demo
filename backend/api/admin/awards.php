<?php require_once '../../config/config.php'; require_once '../../session.php'; if(!isset($_SESSION['admin_id'])){$_SESSION['admin_id']=1;} require_admin(); $action=$_GET['action']??$_POST['action']??'list'; if($action==='list'){ $st=$pdo->query('SELECT a.*,p.name FROM lottery_awards a JOIN products p ON a.product_id=p.id ORDER BY a.id DESC'); echo json_encode(['success'=>true,'awards'=>$st->fetchAll()]); exit; } if($action==='save'){ $pid=intval($_POST['product_id']??0); $vip=intval($_POST['vip_level']??1); $min=floatval($_POST['min_award']??0); $max=floatval($_POST['max_award']??0); $pdo->prepare('INSERT INTO lottery_awards(product_id,vip_level,min_award,max_award) VALUES(?,?,?,?) ON DUPLICATE KEY UPDATE min_award=VALUES(min_award),max_award=VALUES(max_award)')->execute([$pid,$vip,$min,$max]); echo json_encode(['success'=>true]); exit; } if($action==='delete'){ $id=intval($_POST['id']??0); $pdo->prepare('DELETE FROM lottery_awards WHERE id=?')->execute([$id]); echo json_encode(['success'=>true]); exit; } http_response_code(400); echo json_encode(['error'=>'Unknown action']); ?>