const API_BASE='/backend/api';async function j(u,o={}){const r=await fetch(u,Object.assign({headers:{'Content-Type':'application/json'}},o));return r.json()}async function assignTask(){const d=await j(API_BASE+'/tasks/assign_lottery_task.php');if(!d.success){alert(d.error||'Fail');return}const p=d.product;const b=document.getElementById('taskBox');if(b)b.innerHTML=`<div class='card'><h3>${p.name}</h3><p>Price: $${p.price}</p><button class='btn btn-primary' onclick='completeTask(${d.task_id})'>Complete Task</button></div>`}async function completeTask(id){const d=await j(API_BASE+'/tasks/complete_task.php',{method:'POST',body:JSON.stringify({task_id:id})});if(!d.success){alert(d.error||'Fail');return}alert('Award: $'+d.awarded); document.getElementById('taskBox').innerHTML=''; loadTasks();}async function loadTasks(){const d=await j(API_BASE+'/tasks/list_tasks.php');if(!d.success)return;const list=(d.tasks||[]).map(t=>`<div class='card'><b>${t.name}</b><br>Status: ${t.status} | Award: $${t.awarded_amount}<br><small>${t.assigned_at}</small></div>`).join(''); if(document.getElementById('taskList'))document.getElementById('taskList').innerHTML=list||'No tasks'; if(document.getElementById('records'))document.getElementById('records').innerHTML=list||'No records';}document.addEventListener('DOMContentLoaded',()=>{if(document.getElementById('btnAssign'))document.getElementById('btnAssign').onclick=assignTask; loadTasks();});